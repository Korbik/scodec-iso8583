package org.korbik.scodec.iso8583.codec

import org.korbik.scodec.iso8583.model.{BitmapsFields, GenericISO8583Message}
import scodec._
import scodec.bits.BitVector
import scodec.codecs._

import shapeless._

object GenericISO8583Codec {
  def genericIso8583Codec[
      F02,
      F03,
      F04,
      F05,
      F06,
      F07,
      F08,
      F09,
      F10,
      F11,
      F12,
      F13,
      F14,
      F15,
      F16,
      F17,
      F18,
      F19,
      F20,
      F21,
      F22,
      F23,
      F24,
      F25,
      F26,
      F27,
      F28,
      F29,
      F30,
      F31,
      F32,
      F33,
      F34,
      F35,
      F36,
      F37,
      F38,
      F39,
      F40,
      F41,
      F42,
      F43,
      F44,
      F45,
      F46,
      F47,
      F48,
      F49,
      F50,
      F51,
      F52,
      F53,
      F54,
      F55,
      F56,
      F57,
      F58,
      F59,
      F60,
      F61,
      F62,
      F63,
      F64,
      F65,
      F66,
      F67,
      F68,
      F69,
      F70,
      F71,
      F72,
      F73,
      F74,
      F75,
      F76,
      F77,
      F78,
      F79,
      F80,
      F81,
      F82,
      F83,
      F84,
      F85,
      F86,
      F87,
      F88,
      F89,
      F90,
      F91,
      F92,
      F93,
      F94,
      F95,
      F96,
      F97,
      F98,
      F99,
      F100,
      F101,
      F102,
      F103,
      F104,
      F105,
      F106,
      F107,
      F108,
      F109,
      F110,
      F111,
      F112,
      F113,
      F114,
      F115,
      F116,
      F117,
      F118,
      F119,
      F120,
      F121,
      F122,
      F123,
      F124,
      F125,
      F126,
      F127,
      F128](
      fieldMti: Codec[String],
      field02: Codec[F02],
      field03: Codec[F03],
      field04: Codec[F04],
      field05: Codec[F05],
      field06: Codec[F06],
      field07: Codec[F07],
      field08: Codec[F08],
      field09: Codec[F09],
      field10: Codec[F10],
      field11: Codec[F11],
      field12: Codec[F12],
      field13: Codec[F13],
      field14: Codec[F14],
      field15: Codec[F15],
      field16: Codec[F16],
      field17: Codec[F17],
      field18: Codec[F18],
      field19: Codec[F19],
      field20: Codec[F20],
      field21: Codec[F21],
      field22: Codec[F22],
      field23: Codec[F23],
      field24: Codec[F24],
      field25: Codec[F25],
      field26: Codec[F26],
      field27: Codec[F27],
      field28: Codec[F28],
      field29: Codec[F29],
      field30: Codec[F30],
      field31: Codec[F31],
      field32: Codec[F32],
      field33: Codec[F33],
      field34: Codec[F34],
      field35: Codec[F35],
      field36: Codec[F36],
      field37: Codec[F37],
      field38: Codec[F38],
      field39: Codec[F39],
      field40: Codec[F40],
      field41: Codec[F41],
      field42: Codec[F42],
      field43: Codec[F43],
      field44: Codec[F44],
      field45: Codec[F45],
      field46: Codec[F46],
      field47: Codec[F47],
      field48: Codec[F48],
      field49: Codec[F49],
      field50: Codec[F50],
      field51: Codec[F51],
      field52: Codec[F52],
      field53: Codec[F53],
      field54: Codec[F54],
      field55: Codec[F55],
      field56: Codec[F56],
      field57: Codec[F57],
      field58: Codec[F58],
      field59: Codec[F59],
      field60: Codec[F60],
      field61: Codec[F61],
      field62: Codec[F62],
      field63: Codec[F63],
      field64: Codec[F64],
      field65: Codec[F65],
      field66: Codec[F66],
      field67: Codec[F67],
      field68: Codec[F68],
      field69: Codec[F69],
      field70: Codec[F70],
      field71: Codec[F71],
      field72: Codec[F72],
      field73: Codec[F73],
      field74: Codec[F74],
      field75: Codec[F75],
      field76: Codec[F76],
      field77: Codec[F77],
      field78: Codec[F78],
      field79: Codec[F79],
      field80: Codec[F80],
      field81: Codec[F81],
      field82: Codec[F82],
      field83: Codec[F83],
      field84: Codec[F84],
      field85: Codec[F85],
      field86: Codec[F86],
      field87: Codec[F87],
      field88: Codec[F88],
      field89: Codec[F89],
      field90: Codec[F90],
      field91: Codec[F91],
      field92: Codec[F92],
      field93: Codec[F93],
      field94: Codec[F94],
      field95: Codec[F95],
      field96: Codec[F96],
      field97: Codec[F97],
      field98: Codec[F98],
      field99: Codec[F99],
      field100: Codec[F100],
      field101: Codec[F101],
      field102: Codec[F102],
      field103: Codec[F103],
      field104: Codec[F104],
      field105: Codec[F105],
      field106: Codec[F106],
      field107: Codec[F107],
      field108: Codec[F108],
      field109: Codec[F109],
      field110: Codec[F110],
      field111: Codec[F111],
      field112: Codec[F112],
      field113: Codec[F113],
      field114: Codec[F114],
      field115: Codec[F115],
      field116: Codec[F116],
      field117: Codec[F117],
      field118: Codec[F118],
      field119: Codec[F119],
      field120: Codec[F120],
      field121: Codec[F121],
      field122: Codec[F122],
      field123: Codec[F123],
      field124: Codec[F124],
      field125: Codec[F125],
      field126: Codec[F126],
      field127: Codec[F127],
      field128: Codec[F128]): Codec[GenericISO8583Message[
    F02,
    F03,
    F04,
    F05,
    F06,
    F07,
    F08,
    F09,
    F10,
    F11,
    F12,
    F13,
    F14,
    F15,
    F16,
    F17,
    F18,
    F19,
    F20,
    F21,
    F22,
    F23,
    F24,
    F25,
    F26,
    F27,
    F28,
    F29,
    F30,
    F31,
    F32,
    F33,
    F34,
    F35,
    F36,
    F37,
    F38,
    F39,
    F40,
    F41,
    F42,
    F43,
    F44,
    F45,
    F46,
    F47,
    F48,
    F49,
    F50,
    F51,
    F52,
    F53,
    F54,
    F55,
    F56,
    F57,
    F58,
    F59,
    F60,
    F61,
    F62,
    F63,
    F64,
    F65,
    F66,
    F67,
    F68,
    F69,
    F70,
    F71,
    F72,
    F73,
    F74,
    F75,
    F76,
    F77,
    F78,
    F79,
    F80,
    F81,
    F82,
    F83,
    F84,
    F85,
    F86,
    F87,
    F88,
    F89,
    F90,
    F91,
    F92,
    F93,
    F94,
    F95,
    F96,
    F97,
    F98,
    F99,
    F100,
    F101,
    F102,
    F103,
    F104,
    F105,
    F106,
    F107,
    F108,
    F109,
    F110,
    F111,
    F112,
    F113,
    F114,
    F115,
    F116,
    F117,
    F118,
    F119,
    F120,
    F121,
    F122,
    F123,
    F124,
    F125,
    F126,
    F127,
    F128]] = {
      fieldMti ~ BitmapsCodec.bitmapCodec.flatZipHList { bitmap =>
      def bitmapCodec[FC]: (Codec[FC], Long) => Codec[Option[FC]] =
        tobitmapCodec[FC](bitmap)
      bitmapCodec(field02, 2) ~ bitmapCodec(field03, 3) ~ bitmapCodec(
        field04,
        4) ~ bitmapCodec(field05, 5) ~ bitmapCodec(field06, 6) ~ bitmapCodec(
        field07,
        7) ~ bitmapCodec(field08, 8) ~ bitmapCodec(field09, 9) ~ bitmapCodec(
        field10,
        10) ~ bitmapCodec(field11, 11) ~ bitmapCodec(field12, 12) ~ bitmapCodec(
        field13,
        13) ~ bitmapCodec(field14, 14) ~ bitmapCodec(field15, 15) ~ bitmapCodec(
        field16,
        16) ~ bitmapCodec(field17, 17) ~ bitmapCodec(field18, 18) ~ bitmapCodec(
        field19,
        19) ~ bitmapCodec(field20, 20) ~ bitmapCodec(field21, 21) ~ bitmapCodec(
        field22,
        22) ~ bitmapCodec(field23, 23) ~ bitmapCodec(field24, 24) ~ bitmapCodec(
        field25,
        25) ~ bitmapCodec(field26, 26) ~ bitmapCodec(field27, 27) ~ bitmapCodec(
        field28,
        28) ~ bitmapCodec(field29, 29) ~ bitmapCodec(field30, 30) ~ bitmapCodec(
        field31,
        31) ~ bitmapCodec(field32, 32) ~ bitmapCodec(field33, 33) ~ bitmapCodec(
        field34,
        34) ~ bitmapCodec(field35, 35) ~ bitmapCodec(field36, 36) ~ bitmapCodec(
        field37,
        37) ~ bitmapCodec(field38, 38) ~ bitmapCodec(field39, 39) ~ bitmapCodec(
        field40,
        40) ~ bitmapCodec(field41, 41) ~ bitmapCodec(field42, 42) ~ bitmapCodec(
        field43,
        43) ~ bitmapCodec(field44, 44) ~ bitmapCodec(field45, 45) ~ bitmapCodec(
        field46,
        46) ~ bitmapCodec(field47, 47) ~ bitmapCodec(field48, 48) ~ bitmapCodec(
        field49,
        49) ~ bitmapCodec(field50, 50) ~ bitmapCodec(field51, 51) ~ bitmapCodec(
        field52,
        52) ~ bitmapCodec(field53, 53) ~ bitmapCodec(field54, 54) ~ bitmapCodec(
        field55,
        55) ~ bitmapCodec(field56, 56) ~ bitmapCodec(field57, 57) ~ bitmapCodec(
        field58,
        58) ~ bitmapCodec(field59, 59) ~ bitmapCodec(field60, 60) ~ bitmapCodec(
        field61,
        61) ~ bitmapCodec(field62, 62) ~ bitmapCodec(field63, 63) ~ bitmapCodec(
        field64,
        64) ~ bitmapCodec(field65, 65) ~ bitmapCodec(field66, 66) ~ bitmapCodec(
        field67,
        67) ~ bitmapCodec(field68, 68) ~ bitmapCodec(field69, 69) ~ bitmapCodec(
        field70,
        70) ~ bitmapCodec(field71, 71) ~ bitmapCodec(field72, 72) ~ bitmapCodec(
        field73,
        73) ~ bitmapCodec(field74, 74) ~ bitmapCodec(field75, 75) ~ bitmapCodec(
        field76,
        76) ~ bitmapCodec(field77, 77) ~ bitmapCodec(field78, 78) ~ bitmapCodec(
        field79,
        79) ~ bitmapCodec(field80, 80) ~ bitmapCodec(field91, 91) ~ bitmapCodec(
        field92,
        92) ~ bitmapCodec(field93, 93) ~ bitmapCodec(field94, 94) ~ bitmapCodec(
        field95,
        95) ~ bitmapCodec(field96, 96) ~ bitmapCodec(field97, 97) ~ bitmapCodec(
        field98,
        98) ~ bitmapCodec(field99, 99) ~ bitmapCodec(field100, 100) ~ bitmapCodec(field101, 101) ~
        bitmapCodec(field102, 102) ~ bitmapCodec(field103, 103) ~ bitmapCodec(
          field104,
          104) ~ bitmapCodec(field105, 105) ~ bitmapCodec(field106, 106) ~ bitmapCodec(
          field107,
          107) ~ bitmapCodec(field108, 108) ~ bitmapCodec(field109, 109) ~ bitmapCodec(
          field110,
          110) ~ bitmapCodec(field111, 111) ~ bitmapCodec(field112, 112) ~ bitmapCodec(
          field113,
          113) ~ bitmapCodec(field114, 114) ~ bitmapCodec(field115, 115) ~ bitmapCodec(
          field116,
          116) ~ bitmapCodec(field117, 117) ~ bitmapCodec(field118, 118) ~ bitmapCodec(
          field119,
          119) ~ bitmapCodec(field120, 120) ~ bitmapCodec(field121, 121) ~ bitmapCodec(
          field122,
          122) ~ bitmapCodec(field123, 123) ~ bitmapCodec(field124, 124) ~ bitmapCodec(
          field125,
          125) ~ bitmapCodec(field126, 126) ~ bitmapCodec(field127, 127) ~ bitmapCodec(
          field128,
          128)
    }
  }
  def tobitmapCodec[FC](bitmap: BitmapsFields)(
      fieldCodec: Codec[FC],
      fieldIndex: Long): Codec[Option[FC]] =
    scodec.codecs.conditional(bitmap.contains(fieldIndex), fieldCodec)

}
object BitmapsCodec {
  val bitmapDecoder: Decoder[BitmapsFields] = {
    codecs.bits(64).asDecoder.flatMap { bitVector =>
      if (bitVector(1)) {
        codecs.bits(64).asDecoder.map(b2 => BitmapsFields(bitVector ++ b2))
      } else {
        Decoder.point(BitmapsFields(bitVector))
      }
    }
  }

  val bitmapEncoder: Encoder[BitmapsFields] =
    codecs.bits.asEncoder.contramap((bf: BitmapsFields) => bf.bitmap)

  val bitmapCodec: Codec[BitmapsFields] = Codec(bitmapEncoder, bitmapDecoder)
}
